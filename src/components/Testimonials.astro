---
import { getEntry } from 'astro:content';

const testimonialEntry = await getEntry('testimonials', 'testimonials');
const testimonials = testimonialEntry?.data.testimonials_list || [];
---

<section id="testimonials" class="testimonials-wrapper">
    <div class="section-header">
        <h2 class="section-title">What the Experts Say</h2>
        <p class="subtitle">References & Recommendations</p>
    </div>

    <div class="glass-container">
        <div class="carousel-wrapper">
            <button class="nav-btn prev" aria-label="Previous Testimonial">&larr;</button>

            <div class="carousel-track" id="testimonial-track">
                {testimonials.map((item) => (
                    <div class="testimonial-card">
                        <div class="quote-icon">‚ùù</div>
                        <blockquote class="quote-text">{item.quote}</blockquote>
                        <div class="source-info">
                            <div class="line"></div>
                            <cite class="author">{item.source}</cite>
                        </div>
                    </div>
                ))}
            </div>

            <button class="nav-btn next" aria-label="Next Testimonial">&rarr;</button>
        </div>

        <div class="dots-container">
            {testimonials.map((_, index) => (
                <span class="dot" data-index={index}></span>
            ))}
        </div>
    </div>
</section>

<script>
    const track = document.getElementById('testimonial-track');
    const prevBtn = document.querySelector('.prev');
    const nextBtn = document.querySelector('.next');
    
    if (track && prevBtn && nextBtn) {
        const getScrollAmount = () => track.clientWidth * 0.8; 
        nextBtn.addEventListener('click', () => {
            const maxScrollLeft = track.scrollWidth - track.clientWidth;
            if (track.scrollLeft >= maxScrollLeft - 10) {
                track.scrollTo({ left: 0, behavior: 'smooth' });
            } else {
                track.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
            }
        });
        prevBtn.addEventListener('click', () => {
            if (track.scrollLeft <= 10) {
                track.scrollTo({ left: track.scrollWidth, behavior: 'smooth' });
            } else {
                track.scrollBy({ left: -getScrollAmount(), behavior: 'smooth' });
            }
        });
    }
</script>

<style>
.testimonials-wrapper {
    width: 90%;
    max-width: 1200px;
    margin: 4rem auto;
}

.section-header { text-align: center; margin-bottom: 2rem; }

.section-title {
    font-size: var(--text-h1); /* Uses variable */
    font-weight: 800;
    margin-bottom: 0.5rem;
    color: var(--color-text-main);
    letter-spacing: -0.02em;
}

.subtitle {
    font-size: var(--text-h4); /* Uses variable */
    color: var(--color-text-muted);
    font-style: italic;
}

.glass-container {
    padding: 2rem;
    border-radius: var(--radius-card); /* Consistent radius */
    background: rgba(255, 255, 255, 0.65);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
}

.carousel-wrapper { display: flex; align-items: center; position: relative; gap: 1rem; }

.carousel-track {
    display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scroll-behavior: smooth;
    gap: 2rem; scrollbar-width: none; -ms-overflow-style: none;
}
.carousel-track::-webkit-scrollbar { display: none; }

.testimonial-card {
    min-width: 80%;
    scroll-snap-align: center;
    background: rgba(255, 255, 255, 0.9); 
    padding: 2.5rem;
    border-radius: var(--radius-sm);
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
    display: flex; flex-direction: column;
}

.quote-icon { font-size: 3rem; color: #e0e0e0; line-height: 1; margin-bottom: 1rem; }

.quote-text {
    font-size: var(--text-body); /* Uses variable */
    line-height: 1.7;
    color: var(--color-text-light);
    margin: 0;
    flex-grow: 1;
    white-space: pre-line;
}

.source-info { margin-top: 2rem; display: flex; align-items: center; gap: 1rem; }
.line { height: 2px; width: 30px; background-color: var(--color-primary); }
.author { font-weight: 700; font-size: var(--text-body); color: var(--color-text-main); font-style: normal; }

.nav-btn {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(0,0,0,0.1);
    width: 40px; height: 40px; border-radius: 50%;
    cursor: pointer; font-size: 1.2rem; color: #333;
    transition: all 0.2s; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
}
.nav-btn:hover { background: var(--color-primary); color: white; border-color: var(--color-primary); }

@media (max-width: 600px) {
    .nav-btn { display: none; }
    .carousel-wrapper { gap: 0; }
    .testimonial-card { padding: 1.5rem; min-width: 90%; }
    .glass-container { padding: 1rem; }
}
</style>